<!-- Debug template to check related posts matching -->
<div id="related-debug">
  <h2>Debug: Related Posts</h2>
  
  <h3>Page related_posts array:</h3>
  {% if page.related_posts %}
    <ul>
      {% for related_url in page.related_posts %}
        <li>URL: "{{ related_url }}"</li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No related_posts found in page frontmatter</p>
  {% endif %}
  
  <h3>Matching posts:</h3>
  {% if page.related_posts %}
    {% for related_url in page.related_posts %}
      <h4>Looking for: "{{ related_url }}"</h4>
      {% assign found = false %}
      {% for post in site.posts %}
        {% if post.url == related_url %}
          {% assign found = true %}
          <p>✓ Found: {{ post.title }} ({{ post.url }})</p>
          {% break %}
        {% endif %}
      {% endfor %}
      {% unless found %}
        <p>✗ Not found</p>
        <details>
          <summary>Available post URLs (first 10):</summary>
          <ul>
            {% for post in site.posts limit:10 %}
              <li>"{{ post.url }}" - {{ post.title }}</li>
            {% endfor %}
          </ul>
        </details>
      {% endunless %}
    {% endfor %}
  {% endif %}
</div>

<!-- Fixed related posts section -->
<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    {% if page.related_posts %}
      {% for related_url in page.related_posts %}
        {% for post in site.posts %}
          {% if post.url == related_url %}
            <li><span>{{ post.date | date_to_string }}</span> &raquo; <a href="{{ site.baseurl }}{{ post.url }}">{{ post.title }}</a></li>
            {% break %}
          {% endif %}
        {% endfor %}
      {% endfor %}
    {% else %}
      {% for post in site.related_posts limit:3 %}
        <li><span>{{ post.date | date_to_string }}</span> &raquo; <a href="{{ site.baseurl }}{{ post.url }}">{{ post.title }}</a></li>
      {% endfor %}
    {% endif %}
  </ul>
</div>
